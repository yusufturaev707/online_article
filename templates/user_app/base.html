<!DOCTYPE html>
{% load static %}
{% load i18n %}
<html lang="uz">
<head>
    <meta charset="utf-8"/>
    <title>{% block title %}{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'img/logo.ico' %}">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">

    <!-- ================== BEGIN BASE CSS STYLE ================== -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.1/css/dataTables.dataTables.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.2.0/css/buttons.dataTables.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/4.0.1/css/fixedHeader.dataTables.css"/>
    <link href="{% static 'assets/css/google/app.min.css' %}" rel="stylesheet"/>
    <!-- ================== END BASE CSS STYLE ================== -->

    <!-- ================== BEGIN PLUGINS CSS ================== -->
    <link href="{% static 'assets/plugins/switchery/switchery.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/gritter/css/jquery.gritter.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/simple-line-icons/css/simple-line-icons.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/ion-rangeslider/css/ion.rangeSlider.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/bootstrap-select/dist/css/bootstrap-select.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/bootstrap-daterangepicker/daterangepicker.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/select2/dist/css/select2.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/bootstrap-colorpalette/css/bootstrap-colorpalette.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/flag-icon-css/css/flag-icon.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'assets/plugins/ionicons/css/ionicons.min.css' %}" rel="stylesheet"/>
    <!-- ================== END PLUGINS CSS ================== -->

    <!-- ================== BEGIN CUSTOM CSS ================== -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet"/>
    <link href="{% static 'css/style_table.css' %}" rel="stylesheet"/>
    {% block extra_css %}{% endblock %}
    <!-- ================== END CUSTOM CSS ================== -->
</head>
<body style="background-color: #eeeeee" class="viewArticleFont">
<div id="page-loader" class="fade show">
    <span class="spinner"></span>
</div>

{% block base_content %}
    <div id="page-container" class="fade page-sidebar-fixed page-header-fixed page-with-wide-sidebar page-with-light-sidebar">
        {% include 'user_app/includes/header.html' %}
        {% include 'user_app/includes/sidebar.html' %}

        {% block content %}
        {% endblock content %}

        <div id="show_res"></div>
        <a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top">
            <i class="fa fa-angle-up"></i>
        </a>
    </div>
{% endblock base_content %}

<!-- ================== BEGIN BASE JS ================== -->
<script src="{% static 'assets/js/app.min.js' %}"></script>
<script src="{% static 'assets/js/theme/google.min.js' %}"></script>
<!-- ================== END BASE JS ================== -->

<!-- ================== BEGIN PLUGINS JS ================== -->
<script src="{% static 'assets/plugins/jquery-migrate/dist/jquery-migrate.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
<script src="{% static 'assets/plugins/gritter/js/jquery.gritter.js' %}"></script>
<script src="{% static 'assets/plugins/sweetalert/dist/sweetalert.min.js' %}"></script>

<!-- Form Plugins -->
<script src="{% static 'assets/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'assets/plugins/ion-rangeslider/js/ion.rangeSlider.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js' %}"></script>
<script src="{% static 'assets/plugins/jquery.maskedinput/src/jquery.maskedinput.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js' %}"></script>
<script src="{% static 'assets/plugins/pwstrength-bootstrap/dist/pwstrength-bootstrap.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap-select/dist/js/bootstrap-select.min.js' %}"></script>
<script src="{% static 'assets/plugins/tag-it/js/tag-it.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap-daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'assets/plugins/select2/dist/js/select2.min.js' %}"></script>
<script src="{% static 'assets/plugins/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap-show-password/dist/bootstrap-show-password.js' %}"></script>
<script src="{% static 'assets/plugins/bootstrap-colorpalette/js/bootstrap-colorpalette.js' %}"></script>
<script src="{% static 'assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.js' %}"></script>
<script src="{% static 'assets/plugins/clipboard/dist/clipboard.min.js' %}"></script>
<script src="{% static 'assets/plugins/parsleyjs/dist/parsley.min.js' %}"></script>
<script src="{% static 'assets/plugins/switchery/switchery.min.js' %}"></script>

<!-- DataTables -->
<script src="https://cdn.datatables.net/2.2.1/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/fixedheader/4.0.1/js/dataTables.fixedHeader.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.0/js/dataTables.buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.12/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.12/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.0/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.0/js/buttons.colVis.min.js"></script>

<!-- Chart Plugins -->
<script src="{% static 'assets/plugins/flot/jquery.flot.js' %}"></script>
<script src="{% static 'assets/plugins/flot/jquery.flot.time.js' %}"></script>
<script src="{% static 'assets/plugins/flot/jquery.flot.resize.js' %}"></script>
<script src="{% static 'assets/plugins/flot/jquery.flot.pie.js' %}"></script>

<!-- Demo Scripts -->
<script src="{% static 'assets/js/demo/form-plugins.demo.js' %}"></script>
<script src="{% static 'assets/js/demo/ui-modal-notification.demo.js' %}"></script>
<script src="{% static 'assets/js/demo/form-slider-switcher.demo.js' %}"></script>
<!-- ================== END PLUGINS JS ================== -->

<!-- ================== BEGIN CUSTOM JS ================== -->
<script src="{% static 'js/register.js' %}"></script>
<script src="{% static 'js/user.js' %}"></script>
<script src="{% static 'js/test_user.js' %}"></script>
<script src="{% static 'js/editor.js' %}"></script>
<script src="{% static 'js/reviewer.js' %}"></script>
<script src="{% static 'js/showModal.js' %}"></script>

{% block extra_js %}{% endblock %}
<!-- ================== END CUSTOM JS ================== -->

<!-- ================== BEGIN SESSION TIMEOUT HANDLER ================== -->
{% if user.is_authenticated %}
<script>
(function() {
    // Global AJAX error handler for session timeout
    $(document).ajaxError(function(event, jqXHR, settings, thrownError) {
        if (jqXHR.status === 401) {
            try {
                var response = JSON.parse(jqXHR.responseText);
                if (response.session_expired) {
                    swal({
                        title: "{% trans 'Sessiya tugadi' %}",
                        text: "{% trans 'Sessiya muddati tugadi. Qayta kirishingiz kerak.' %}",
                        icon: "warning",
                        button: "{% trans "Kirish sahifasiga o'tish" %}"
                    }).then(function() {
                        window.location.href = response.redirect_url || '/login/';
                    });
                }
            } catch (e) {
                // JSON parse error - ignore
            }
        }
    });

    // Session activity monitor - warn before timeout
    var sessionWarningShown = false;
    var sessionTimeout = {{ session_timeout_minutes|default:15 }};  // Minutes
    var warningTime = (sessionTimeout - 2) * 60 * 1000;  // 2 minutes before timeout

    setTimeout(function() {
        if (!sessionWarningShown) {
            sessionWarningShown = true;
            swal({
                title: "{% trans 'Sessiya ogohlantirishi' %}",
                text: "{% trans 'Sizning sessiyangiz tez orada tugaydi. Davom etishni xohlaysizmi?' %}",
                icon: "warning",
                buttons: {
                    cancel: "{% trans 'Chiqish' %}",
                    confirm: "{% trans 'Davom etish' %}"
                }
            }).then(function(willContinue) {
                if (willContinue) {
                    // Refresh session by making a simple request
                    $.get('/profile/api/session-refresh/').fail(function() {
                        // If no such endpoint, just reload
                        window.location.reload();
                    });
                } else {
                    window.location.href = '/profile/logout/';
                }
            });
        }
    }, warningTime);
})();
</script>
{% endif %}
<!-- ================== END SESSION TIMEOUT HANDLER ================== -->

</body>
</html>