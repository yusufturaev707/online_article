{% extends 'user_app/base.html' %}
{% load i18n static %}

{% block title %}{% trans "Taqrizchi roliga davogar talabgorlar ro'yxati" %}{% endblock %}

{% block content %}
<style>
    .submission-panel { background-color: #ffffff; border-radius: 5px; padding: 15px; }
    .badge-status-1 { background-color: #ffc107; color: #000; } /* Warning */
    .badge-status-2 { background-color: #28a745; } /* Success */
    .badge-status-3 { background-color: #dc3545; } /* Danger */
    .table-v-align td { vertical-align: middle !important; }
</style>

<div id="content" class="content">
    <h2 class="page-header viewArticleFont">
        {% trans "Taqrizchi roliga davogar talabgorlar ro'yxati" %}
    </h2>

    <div class="panel-body forshadow submission-panel">
        <div class="table-responsive">
            <table class="table table-hover table-v-align">
                <thead>
                    <tr>
                        <th width="50">#</th>
                        <th>{% trans "F.I.O" %}</th>
                        <th>{% trans "E-mail" %}</th>
                        <th>{% trans "Ilmiy daraja" %}</th>
                        <th>{% trans "Holat" %}</th>
                        <th width="100">{% trans "Amallar" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for submission in submissions %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><strong>{{ submission.reviewer.user.full_name }}</strong></td>
                        <td>{{ submission.reviewer.user.email }}</td>
                        <td>{{ submission.reviewer.scientific_degree|default:"-" }}</td>
                        <td>
                            {# Dinamik badge klassi #}
                            <span class="badge badge-status-{{ submission.status.id }}">
                                {{ submission.status.name }}
                            </span>
                        </td>
                        <td>
                            <button type="button"
                                    onclick="viewReviewerDetail({{ submission.reviewer.id }}, this)"
                                    class="btn btn-sm btn-outline-primary forshadow"
                                    title="{% trans 'Korish' %}">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">{% trans "Ma'lumot topilmadi" %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="reviewer_submission_div"></div>

{% endblock %}

{% block extra_js %}
<script>
    function viewReviewerDetail(id, btn) {
        const $btn = $(btn);
        const originalHtml = $btn.html();

        // Yuklanish holati (Spinner)
        $btn.html('<i class="fas fa-spinner fa-spin"></i>').prop('disabled', true);

        $.ajax({
            type: "GET",
            url: `/profile/choosen_reviewer_role_list/${id}/`,
            success: function (response) {
                $('#reviewer_submission_div').html(response);
                $('#reviewer_role_list_detail_modal').modal('show');
            },
            error: function (xhr) {
                console.error(xhr);
                swal({
                    title: "{% trans 'Xatolik!' %}",
                    text: "{% trans 'Maâ€™lumotni yuklashda xatolik yuz berdi' %}",
                    icon: "error",
                });
            },
            complete: function () {
                // Tugmani asliga qaytarish
                $btn.html(originalHtml).prop('disabled', false);
            }
        });
    }
</script>
{% endblock %}