{% extends 'user_app/base.html' %}
{% load i18n %}
{% load static %}
{% block title %}{% trans "To'lov uchun" %}{% endblock %}
{% block content %}
    <div id="content" class="content viewArticleFont">
        <div class="panel-body forshadow" style="background-color: #ffffff; border-radius: 5px; padding: 2em;">
            <form method="post" id="filterDateRangeForm" data-url="{% url 'load_question_payment_list' %}">
                {% csrf_token %}
                <div class="form-group row">
                <div class="col-lg-4">
                    <label for="selectPaymnet"><i class="fa fa-cloud" style="color: #0b6bfa; font-size: x-large"></i></label> 
                    &nbsp;<select class="selectpicker" id="selectPaymnet" name="select_payment">
                            <option value="" selected>------</option>
                       {% for item in items %}
                       	    <option value="{{ item.key }}">{{ item.name }}</option>
                       {% endfor %}
                    </select>
                </div>
                <div class="col-lg-8">
                    <div class="row row-space-10">
                        <div class="col-xs-4 mb-2 mb-sm-0">
                            <input type="text" class="form-control forshadow inputStartDate" name="start_date" id="datetimepicker3" placeholder="Start Date"/>
                        </div>
                        <div class="col-xs-4">
                            <input type="text" class="form-control forshadow inputEndtDate" name="end_date" id="datetimepicker4" placeholder="End Date"/>
                        </div>
                        <div class="col-xs-1">
                                <button type="submit" class="btn btn-info btn-md forshadow" id="filterDateRangeBtn"><i class="fa fa-filter fa-lg"></i></button>
                        </div>
                        <div class="col-xs-3">
                            <a href="#" target="_top" class="btn btn-green btn-md forshadow" id="fileDownloadBtn" style="float: right; display: none"><i class="fa fa-file-excel fa-lg"></i> &nbsp;{% trans "MS Excell" %}</a>
                        </div>
                    </div>
                </div>
                </div>
            </form>
        <div class="table-responsive">
                <table class="table styled-table table-hover display dt-responsive compact nowrap"
                       id="questionsSendingCount" style="width:100%;">
                    <thead class="table">
                    <tr>
                        <th><strong>{% trans "ID" %}</strong></th>
                        <th><strong>{% trans "FIO" %}</strong></th>
                        <th><strong>{% trans "Pnfl" %}</strong></th>
                        <th><strong>{% trans "Fan" %}</strong></th>
                        <th><i class="fa fa-microphone"></i> &nbsp;Part1</th>
                        <th><i class="fa fa-microphone"></i> &nbsp;Part2</th>
                        <th><i class="fa fa-microphone"></i> &nbsp;Part3</th>
                        <th><i class="fa fa-pen-alt"></i> &nbsp;Task1</th>
                        <th><i class="fa fa-pen-alt"></i> &nbsp;Task2</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="ViewIncomingQuestionAdmin1Div"></div>
    <script type="text/javascript">
        $(document).ready(function () {
            let tableBody = $('#questionsSendingCount tbody');
            loadItems();

            function loadItems() {
                $.ajax({
                    url: "{% url 'load_question_payment_list' %}",
                    type: 'GET',
                    dataType: 'json',
                    success: function (response) {
                        let items = response.data;
                        tableBody.empty();
                        $.each(items, function (index, item) {
                            // Safe DOM manipulation - use textContent instead of string concatenation
                            let row = document.createElement('tr');
                            let cells = [item.id, item.fio, item.pnfl, item.subject, item.p1, item.p2, item.p3, item.t1, item.t2];
                            cells.forEach(function(cellData) {
                                let td = document.createElement('td');
                                td.textContent = cellData;
                                row.appendChild(td);
                            });
                            tableBody.append(row);
                        });
                    },
                    error: function (error) {
                        console.log("Error:", error);
                    }
                });
            }
            
            $('body').on('submit', '#filterDateRangeForm', function (e) {
                e.preventDefault();
                let url = $(this).data('url');
                let formData = $('#filterDateRangeForm')

                $.ajax({
                    type: 'POST',
                    url: url,
                    data: formData.serialize(),
                    success: function (response) {
                        let result = response['result'];
                        if (result === 1) {
                            let items = response.data;
                            tableBody.empty();
                            $.each(items, function (index, item) {
                                // Safe DOM manipulation - use textContent instead of string concatenation
                                let row = document.createElement('tr');
                                let cells = [item.id, item.fio, item.pnfl, item.subject, item.p1, item.p2, item.p3, item.t1, item.t2];
                                cells.forEach(function(cellData) {
                                    let td = document.createElement('td');
                                    td.textContent = cellData;
                                    row.appendChild(td);
                                });
                                tableBody.append(row);
                            });
                            $('#fileDownloadBtn').css("display", "block");
                            $('#fileDownloadBtn').attr("href", response.link);
                        } else if (result === 0){
                            swal({
                                text: response.message,
                                icon: 'error',
                                timer: 5000,
                            });
                        }
                        
                    },
                    error: function (error) {
                        alert(error);
                    },
                });
            });
        });
    </script>
{% endblock %}